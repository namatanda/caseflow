generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model Court {
  id        String    @id @default(uuid())
  courtName String    @map("court_name")
  courtCode String    @unique @map("court_code")
  courtType CourtType @map("court_type")
  isActive  Boolean   @default(true) @map("is_active")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @default(now()) @updatedAt @map("updated_at")
  cases                Case[]
  originalCases        Case[]                @relation("OriginalCases")

  @@index([courtType, isActive])
  @@index([courtName])
  @@index([courtCode])
  @@map("courts")
}

model Judge {
  id              String                @id @default(uuid())
  fullName        String                @map("full_name")
  firstName       String                @map("first_name")
  lastName        String                @map("last_name")
  isActive        Boolean               @default(true) @map("is_active")
  createdAt       DateTime              @default(now()) @map("created_at")
  updatedAt       DateTime              @updatedAt @map("updated_at")
  caseActivities  CaseActivity[]        @relation("PrimaryJudge")
  judge2Activities CaseActivity[]       @relation("Judge2")
  judge3Activities CaseActivity[]       @relation("Judge3")
  judge4Activities CaseActivity[]       @relation("Judge4")
  judge5Activities CaseActivity[]       @relation("Judge5")
  judge6Activities CaseActivity[]       @relation("Judge6")
  judge7Activities CaseActivity[]       @relation("Judge7")
  caseAssignments CaseJudgeAssignment[]

  @@index([fullName])
  @@index([firstName, lastName])
  @@index([isActive])
  @@map("judges")
}

model CaseType {
  id           String   @id @default(uuid())
  caseTypeName String   @map("case_type_name") 
  caseTypeCode String   @unique @map("case_type_code") 
  description  String?
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  cases        Case[]

  @@index([caseTypeName])
  @@index([isActive])
  @@map("case_types")
}

model Case {
  id                     String                @id @default(uuid())
  caseNumber             String                @map("case_number")
  courtId                String                @map("court_id")
  originalCourtId        String?               @map("original_court_id")
  caseTypeId             String                @map("case_type_id")
  filedDate              DateTime              @map("filed_date")
  originalCaseNumber     String?               @map("original_case_number")
  originalYear           Int?                  @map("original_year")
  status                 CaseStatus            @default(ACTIVE)
  lastActivityDate       DateTime?             @map("next_activity_date")
  totalActivities        Int                   @default(0) @map("total_activities")
  hasLegalRepresentation Boolean               @default(false) @map("has_legal_representation")
  createdAt              DateTime              @default(now()) @map("created_at")
  updatedAt              DateTime              @updatedAt @map("updated_at")
  caseidNo               String?               @map("caseid_no")
  maleApplicant          Int?                  @default(0) @map("male_applicant")
  femaleApplicant        Int?                  @default(0) @map("female_applicant")
  organizationApplicant  Int?                  @default(0) @map("organization_applicant")
  maleDefendant          Int?                  @default(0) @map("male_defendant")
  femaleDefendant        Int?                  @default(0) @map("female_defendant")
  organizationDefendant  Int?                  @default(0) @map("organization_defendant")
  activities             CaseActivity[]
  judgeAssignments       CaseJudgeAssignment[]
  parties                Party[]
  caseType               CaseType              @relation(fields: [caseTypeId], references: [id])
  court                  Court                 @relation(fields: [courtId], references: [id])
  originalCourt          Court?                @relation("OriginalCases", fields: [originalCourtId], references: [id])

  @@unique([caseNumber, courtId], name: "case_number_court_unique")
  @@index([status, filedDate(sort: Desc)])
  @@index([caseTypeId, filedDate(sort: Desc)])
  @@index([filedDate(sort: Desc)])
  @@index([caseNumber])
  @@index([courtId])
  @@index([status])

  @@index([lastActivityDate(sort: Desc)])
  @@index([maleApplicant])
  @@index([femaleApplicant])
  @@index([maleDefendant])
  @@index([femaleDefendant])
  @@index([organizationApplicant])
  @@index([organizationDefendant])
  @@map("cases")
}

model CaseActivity {
  id                     String           @id @default(uuid())
  caseId                 String           @map("case_id")
  activityDate           DateTime         @map("activity_date")
  activityType           String           @map("activity_type")
  outcome                String
  reasonForAdjournment   String?          @map("reason_for_adjournment")
  nextHearingDate        DateTime?        @map("next_hearing_date")
  primaryJudgeId         String           @map("primary_judge_id")
  hasLegalRepresentation Boolean          @map("has_legal_representation")
  applicantWitnesses     Int              @default(0) @map("applicant_witnesses")
  defendantWitnesses     Int              @default(0) @map("defendant_witnesses")
  custodyStatus          CustodyStatus    @map("custody_status")
  details                String?
  importBatchId          String           @map("import_batch_id")
  createdAt              DateTime         @default(now()) @map("created_at")
  judge2Id               String?          @map("judge_2_id")
  judge3Id               String?          @map("judge_3_id")
  judge4Id               String?          @map("judge_4_id")
  judge5Id               String?          @map("judge_5_id")
  judge6Id               String?          @map("judge_6_id")
  judge7Id               String?          @map("judge_7_id")
  comingFor              String?          @map("coming_for")
  legalRepString         String?          @map("legal_rep_string")
  custodyNumeric         Int?             @map("custody_numeric")
  otherDetails           String?          @map("other_details")
  case                   Case             @relation(fields: [caseId], references: [id], onDelete: Cascade)
  importBatch            DailyImportBatch @relation(fields: [importBatchId], references: [id])
  primaryJudge           Judge            @relation("PrimaryJudge", fields: [primaryJudgeId], references: [id])
  judge2                 Judge?           @relation("Judge2", fields: [judge2Id], references: [id])
  judge3                 Judge?           @relation("Judge3", fields: [judge3Id], references: [id])
  judge4                 Judge?           @relation("Judge4", fields: [judge4Id], references: [id])
  judge5                 Judge?           @relation("Judge5", fields: [judge5Id], references: [id])
  judge6                 Judge?           @relation("Judge6", fields: [judge6Id], references: [id])
  judge7                 Judge?           @relation("Judge7", fields: [judge7Id], references: [id])

  @@index([caseId, activityDate(sort: Desc)])
  @@index([activityDate(sort: Desc)])
  @@index([primaryJudgeId, activityDate(sort: Desc)])
  @@index([outcome, activityDate(sort: Desc)])
  @@index([activityType])
  @@index([importBatchId])
  @@index([custodyStatus])
  @@index([comingFor])
  @@index([legalRepString])
  @@index([custodyNumeric])
  @@index([judge2Id], map: "case_activities_judge2_idx")
  @@index([judge3Id], map: "case_activities_judge3_idx")
  @@index([judge4Id], map: "case_activities_judge4_idx")
  @@index([judge5Id], map: "case_activities_judge5_idx")
  @@index([judge6Id], map: "case_activities_judge6_idx")
  @@index([judge7Id], map: "case_activities_judge7_idx")
  @@map("case_activities")
}

model CaseJudgeAssignment {
  caseId     String   @map("case_id")
  judgeId    String   @map("judge_id")
  assignedAt DateTime @default(now()) @map("assigned_at")
  isPrimary  Boolean  @default(false) @map("is_primary")
  case       Case     @relation(fields: [caseId], references: [id], onDelete: Cascade)
  judge      Judge    @relation(fields: [judgeId], references: [id])

  @@id([caseId, judgeId])
  @@index([caseId])
  @@index([judgeId])
  @@index([isPrimary])
  @@map("case_judge_assignments")
}

model DailyImportBatch {
  id                      String              @id @default(uuid())
  importDate              DateTime            @map("import_date") 
  filename                String              
  fileSize                Int                 @map("file_size")
  fileChecksum            String              @map("file_checksum") 
  totalRecords            Int                 @map("total_records")
  successfulRecords       Int                 @map("successful_records")
  failedRecords           Int                 @map("failed_records")
  errorLogs               String              @map("error_logs")
  status                  ImportStatus
  createdAt               DateTime            @default(now()) @map("created_at")
  completedAt             DateTime?           @map("completed_at")
  createdBy               String              @map("created_by")
  estimatedCompletionTime DateTime?           @map("estimated_completion_time")
  processingStartTime     DateTime?           @map("processing_start_time")
  userConfig              String              @default("{}") @map("user_config")
  validationWarnings      String              @default("[]") @map("validation_warnings")
  emptyRowsSkipped        Int?                @default(0) @map("empty_rows_skipped")
  activities              CaseActivity[]
  user                    User                @relation(fields: [createdBy], references: [id])
  errorDetails            ImportErrorDetail[]

  @@index([importDate(sort: Desc)])
  @@index([status])
  @@index([createdBy])
  @@index([filename])
  @@map("daily_import_batches")
}

model User {
  id            String             @id @default(uuid())
  email         String             @unique
  name          String
  password      String
  role          UserRole           @default(DATA_ENTRY)
  isActive      Boolean            @default(true) @map("is_active")
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")
  importBatches DailyImportBatch[]

  @@index([email])
  @@index([role])
  @@index([isActive])
  @@map("users")
}

model ImportErrorDetail {
  id           String           @id @default(uuid())
  batchId      String
  rowNumber    Int
  errorType    String           
  errorMessage String
  severity     ErrorSeverity
  createdAt    DateTime         @default(now())
  batch        DailyImportBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId])
  @@index([rowNumber])
  @@index([severity])
  @@map("import_error_details")
}

enum CourtType {
  SC
  ELC
  ELRC
  KC
  SCC
  COA
  MC
  HC
  TC

  @@map("CourtType")
}

enum CaseStatus {
  ACTIVE
  RESOLVED
  PENDING
  TRANSFERRED
  DELETED

  @@map("case_status")
}

enum CustodyStatus {
  IN_CUSTODY
  ON_BAIL
  NOT_APPLICABLE

  @@map("custody_status")
}

enum ImportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED

  @@map("import_status")
}

enum UserRole {
  ADMIN
  DATA_ENTRY
  VIEWER

  @@map("user_role")
}

enum ErrorSeverity {
  ERROR
  WARNING
  INFO

  @@map("error_severity")
}

enum PartyType {
  APPLICANT
  DEFENDANT

  @@map("party_type")
}

model Party {
  id             String    @id @default(uuid())
  caseId         String    @map("case_id")
  name           String?
  type           PartyType
  isOrganization Boolean   @default(false) @map("is_organization")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  case           Case      @relation(fields: [caseId], references: [id], onDelete: Cascade)

  @@index([caseId])
  @@index([type])
  @@map("parties")
}